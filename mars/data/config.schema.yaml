$schema: "http://json-schema.org/draft-04/schema#"
description: "Configuration file for MARS"
properties:
  project_name:
    description: "Project name (for reports)"
    type: string
  output_dir:
    description: "Path to output directory for MARS"
    type: string
    format: directory
    must_exist: False
  samplesheet_fp:
    description: "Path to samplesheet, in tab-delimited format"
    type: string
    format: file
    must_exist: True
  fast5_dir:
    description: "Path to directory containing fast5 files (searched recursively)"
    type: string
    format: directory
    must_exist: True
  basecaller:
    description: "ONT basecaller to use"
    type: string
    enum:
      - guppy
      - albacore
  basecaller_threads:
    description: "Threads to provide to the basecaller"
    type: number
    minimum: 1
  flowcell:
    description: "Nanopore flow cell"
    type: string
  kit:
    description: "Nanopore library kit"
    type: string
  guppy_prefix_opt:
    description: "Shell commands to execute prior to guppy commands (i.e. to load a module on a cluster). Consider ending with && or ;."
    type: string
  filt_min_length:
    description: "Minimum read length to keep"
    type: number
    minimum: 0
  filt_keep_percent:
    description: "Percent of bp to keep"
    type: number
    minimum: 0
    maximum: 100
  filt_target_bases:
    description: "Keep up to this many bp"
    type: number
    minimum: 1
  assembler:
    description: "Assembler(s) to use"
    type: array
    items:
      type: string
      enum:
        - canu
        - unicycler
        - rebaler
        - flye
        - wtdbg2
  assembler_threads:
    description: "Threads to provide to the assembler"
    type: number
    minimum: 1
  canu_max_mem:
    description: "Memory to allocate to Canu, in megabytes"
    type: number
    minimum: 1
  unicycler_mode:
    description: "Assembly mode for Unicycler"
    type: string
    enum:
      - conservative
      - normal
      - bold
  flye_polish_iterations:
    description: "Number of iteration rounds Flye will perform"
    type: number
    minimum: 0
  ref_genomes_dir:
    description: "Directory containing (only) one or more reference genome(s), in fasta format"
    type: string
    format: directory
    must_exist: True
  ref_genome_size:
    description: "Approximate size of reference genome. Formats like 5.5m or 3g are allowed"
    type: string
  mash_k_size:
    description: "Size of kmers to use to build reference genome sketch (larger improves specificity, smaller improves sensitivity)"
    type: number
    minimum: 1
    maximum: 32
  nanopolish_fp:
    description: "Alternate path to nanopolish if not on $PATH, or a specific executable is required"
    type: string
    format: filepath
    must_exist: True
  polisher_threads:
    description: "Threads to provide to polisher"
    type: number
    minimum: 1
required:
  - output_dir
  - samplesheet_fp
target_requirements:
  process:
    - basecaller
    - fast5_dir
    - flowcell
    - kit
  assemble:
    - assembler
    - ref_genomes_dir
  polish:
    - basecaller
    - assembler
    - fast5_dir
    - ref_genomes_dir
assembler_requirements:
  canu:
    - canu_max_mem
    - ref_genome_size
  wtdbg:
    - ref_genome_size
  flye:
    - ref_genome_size
