$schema: "http://json-schema.org/draft-04/schema#"
description: "Configuration file for MARS"
properties: 
  output_dir:
    description: "Path to output directory for MARS"
    type: string
    format: directory
    must_exist: False
  samplesheet_fp:
    description: "Path to samplesheet, in tab-delimited format"
    type: string
    format: filepath
    must_exist: True
  fast5_dir:
    description: "Path to directory containing fast5 files (searched recursively)"
    type: string
    format: directory
    must_exist: True
  basecaller:
    description: "ONT basecaller to use"
    type: string
    enum:
      - guppy
      - albacore
    default: albacore
  flowcell:
    description: "Nanopore flow cell used (from `read_fast5_basecaller.py -l`)"
    type: string
    default: "FLO-MIN106"
  kit:
    description: "Nanopore library kit used (from `read_fast5_basecaller.py -l`)"
    type: string
    default: "SQK-RBK004"
  guppy_threads:
    description: "Threads to provide to Guppy"
    type: number
    minimum: 1
  albacore_threads:
    description: "Threads to provide to Albacore"
    type: number
    minimum: 1
  assembler:
    description: "Assembler to use"
    type: string
    enum:
      - canu
      - unicycler
      - rebaler
    default: rebaler
  canu_max_mem:
    description: "Memory to allocate to Canu, in megabytes"
    type: number
    minimum: 1
  canu_threads:
    description: "Threads to provide to Canu"
    type: number
    minimum: 1
  unicycler_threads:
    description: "Threads to provide to Unicycler"
    type: number
    minimum: 1
  rebaler_threads:
    description: "Threads to provide to Rebaler"
    type: number
    minimum: 1
  minimap2_threads:
    description: "Threads to provide to minimap2"
    type: number
    minimum: 1
  ref_genome_size:
    description: "Size of reference genome, in bases"
    type: number
    minimum: 1
  ref_genome_fp:
    description: "Path to reference genome in FASTA format"
    type: string
    format: filepath
    must_exist: True
required:
  - output_dir
  - samplesheet_fp
  - basecaller
target_requirements:
  assemble:
    - assembler
  process:
    - basecaller
    - fast5_dir
    - flowcell
    - kit
  polish:
    - basecaller
    - assembler
    - fast5_dir
assembler_requirements:
  canu:
    - canu_max_mem
    - ref_genome_size
  rebaler:
    - ref_genome_fp
